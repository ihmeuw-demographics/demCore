<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregate life table(s) to less granular age groups — agg_lt • demCore</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Aggregate life table(s) to less granular age groups — agg_lt" />
<meta property="og:description" content="Aggregate life table(s) to less granular age groups using
standard life table aggregation functions of qx (and ax)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">demCore</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/ccmpp.html">Cohort Component Method of Population Projection (CCMPP)</a>
    </li>
    <li>
      <a href="../articles/introduction_to_life_tables.html">Introduction to life tables</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ihmeuw-demographics/demCore/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregate life table(s) to less granular age groups</h1>
    <small class="dont-index">Source: <a href='https://github.com/ihmeuw-demographics/demCore/blob/master/R/agg_lt.R'><code>R/agg_lt.R</code></a></small>
    <div class="hidden name"><code>agg_lt.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Aggregate life table(s) to less granular age groups using
standard life table aggregation functions of qx (and ax).</p>
    </div>

    <pre class="usage"><span class='fu'>agg_lt</span>(
  <span class='kw'>dt</span>,
  <span class='kw'>id_cols</span>,
  <span class='kw'>age_mapping</span>,
  missing_dt_severity = <span class='st'>"stop"</span>,
  drop_present_aggs = <span class='kw'>F</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dt</th>
      <td><p>[<code>data.table()</code>]<br />
Life table  to be aggregated. Must include all columns in <code>id_cols</code>, and
at least two of 'qx', 'ax', and 'mx', or just 'qx'.</p></td>
    </tr>
    <tr>
      <th>id_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br />
ID columns that uniquely identify each row of <code>dt</code>.</p></td>
    </tr>
    <tr>
      <th>age_mapping</th>
      <td><p>[<code>data.table()</code>]<br />
Specification of intervals to aggregate to. Required columns are
'age_start' and 'age_end'. Use "Inf" as 'age_end' for terminal age group.
The age group intervals must be contiguous and cover the entire interval
specified in the input life tables <code>dt</code>.</p></td>
    </tr>
    <tr>
      <th>missing_dt_severity</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character(1)</a></code>]<br />
How severe should the consequences of missing data that prevents
aggregation or scaling from occurring be? Can be either 'stop', 'warning',
'message', or 'none'. If not "stop", then only the possible aggregations or
scaling is done using the available data.</p></td>
    </tr>
    <tr>
      <th>drop_present_aggs</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/logical.html'>logical(1)</a></code>]<br />
Whether to drop aggregates (or overlapping intervals) that are already
present in <code>dt</code> before aggregating. Default is 'False' and the function
errors out.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>[<code>data.table()</code>]<br /> Aggregated life table(s) with columns for all
<code>id_cols</code>. A column for 'qx' is always included, a column for 'ax' will
also be returned if two of 'qx', 'ax', and 'mx' are included in the input
<code>dt</code>. Will only return the age groups specified in <code>age_mapping</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>See the <a href='https://ihmeuw-demographics.github.io/demCore/index.html'>references page</a>
for the formatted equations below.</p>
<p>This function works by aggregating the qx and ax life table parameters
separately. If only qx is included in <code>dt</code> then ax aggregation is not done.</p>
<p><strong>qx aggregation:</strong></p>
<p>To explain how qx is aggregated it is useful to define a couple of different
events:
$$D = \text{death between age } x \text{ and } x + n$$
$$D' = \text{survival between age } x \text{ and } x + n$$
$$S = \text{survival to age } x$$</p>
<p>Now qx and px can be written in terms of events D and S.
$${}_{n}q_x = P(D | S)$$
$${}_{n}p_x = P(D' | S)$$</p>
<p>Now say there are multiple sub age-groups that make up the overall age group
between \(x \text{ and } x + n\). Let subscripts "1" and "2" indicate
values specific to the first and second sub age-groups and assume values with
no subscript apply to the original aggregate age group. The first sub
age-group could be between \(x \text{ and } x + n_1\) and the second
between \(x + n_1 \text{ and } x + n_1 + n_2\), where \(n_1 + n_2 = n\).</p>
<p>The overall px value can be written as a function of the sub age-group's px
values.
$$P(D'|S) = P(D'_1|B_1) \cap P(D'_2|B_2) = P(D'_1|B_1) * P(D'_2|B_2)$$</p>
<p>where:
$$P(D'_1 | B_1) = \text{survival between age } x \text{ and } x + n_1
  \text{ given survival to age } x$$
$$P(D'_2 | B_2) = \text{survival between age } x + n_1 \text{ and } x + n
  \text{ given survival to age } x + n_1$$</p>
<p>More generally if there are \(A\) age groups between age
\(x \text{ and } x + n\), and \(i\) indexes each of the sub age
intervals then:
$${}_{n}p_x = \prod_{i=1}^{A} {}_{n_i}p_{x_i} =
  \prod_{i=1}^{A}(1 - {}_{n_i}q_{x_i})$$
$${}_{n}q_x = 1 - {}_{n}p_x$$</p>
<p><strong>ax aggregation:</strong></p>
<p>\({}_{n}a_x\) is aggregated across age groups by aggregating the number of
person-years lived in each age group by those who died in the interval.</p>
<p>$${}_{n}a_x \cdot {}_{n}d_x = \text{person-years lived between age } x
  \text{ and } x + n \text{ by those who died in this age interval}$$
where:
$${}_{n}a_x = \text{average years lived between age } x \text{ and }
  x + n \text{ by those who died in the age interval}$$
$${}_{n}d_x = \text{number that died between age } x \text{ and } x + n$$</p>
<p>Now say there are \(A\) age groups between age \(x \text{ and } x + n\),
and \(i\) indexes each of the sub age intervals. The total number of
person-years lived by those who died in the aggregate age group is a simple
sum of the number of person-years lived in each sub age interval.
$${}_{n}a_x \cdot {}_{n}d_x = \sum_{i = 1}^{A}
  ((x_i - x) + {}_{n_i}a_{x_i}) \cdot {}_{n_i}d_{x_i}$$
where:
$$x_i - x = \text{ number of complete person years lived in the previous
  sub age intervals by someone who dies in sub age interval } i$$</p>
<p>The aggregate ax can then be solved for.
$${}_{n}a_x = \frac{\sum_{i = 1}^{A} ((x_i - x) + {}_{n_i}a_{x_i})
  \cdot {}_{n_i}d_{x_i}}{\sum_{i = 1}^{A} {}_{n_i}d_{x_i}}$$</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/pkg/hierarchyUtils/man/agg_scale.html'>hierarchyUtils::agg()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>dt</span> <span class='op'>&lt;-</span> <span class='kw'>data.table</span>::<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span>(
  age_start = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span><span class='op'>:</span><span class='fl'>110</span>),
  age_end = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>1</span><span class='op'>:</span><span class='fl'>110</span>, <span class='fl'>Inf</span>),
  location = <span class='st'>"Canada"</span>,
  qx = <span class='fl'>.2</span>,
  ax = <span class='fl'>.5</span>
)
<span class='kw'>id_cols</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"age_start"</span>, <span class='st'>"age_end"</span>, <span class='st'>"location"</span>)
<span class='kw'>dt</span> <span class='op'>&lt;-</span> <span class='fu'>agg_lt</span>(
  dt = <span class='kw'>dt</span>,
  id_cols = <span class='kw'>id_cols</span>,
  age_mapping = <span class='kw'>data.table</span>::<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span>(
    age_start = <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>110</span>, <span class='fl'>5</span>),
    age_end = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>5</span>, <span class='fl'>110</span>, <span class='fl'>5</span>), <span class='fl'>Inf</span>)
  )
)

<span class='kw'>dt</span> <span class='op'>&lt;-</span> <span class='fu'>agg_lt</span>(
  dt = <span class='kw'>dt</span>[, <span class='kw'>.SD</span>, .SDcols = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>id_cols</span>, <span class='st'>"qx"</span>)],
  id_cols = <span class='kw'>id_cols</span>,
  age_mapping = <span class='kw'>data.table</span>::<span class='fu'><a href='https://Rdatatable.gitlab.io/data.table/reference/data.table.html'>data.table</a></span>(
    age_start = <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>0</span>, <span class='fl'>110</span>, <span class='fl'>5</span>),
    age_end = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span>(<span class='fl'>5</span>, <span class='fl'>110</span>, <span class='fl'>5</span>), <span class='fl'>Inf</span>)
  )
)
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Katie Paulson, Grant Nguyen, Charlton Callender, Spencer Pease, Haidong Wang, Institute for Health Metrics and Evaluation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


